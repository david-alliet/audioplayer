function detectAudioPlayers(){for(var t=document.getElementsByClassName("dal_audioplayer"),e=0;e<t.length;e++)new AudioPlayer(t[e])}function AudioPlayer(t){this.audioPlayerElement=t,this.mode=t.dataset.mode,this.trackList=[],this.trackIndex=0,this.totalTracks=0,this.progressTimer=null,this.playing=!1,this.pausing=!1,this.seeking=!1,this.muted=!1,this.globalVolume=1,this.volumeDrag=!1;for(var e=this.audioPlayerElement.getElementsByTagName("audio"),s=0;s<e.length;s++){var a=new Track(e[s]);e[s].parentNode.className="apTrack",e[s].parentNode.dataset.number=s,e[s].parentNode.tabIndex=s+1,e[s].parentNode.addEventListener("mousedown",playTrack.bind(this)),e[s].parentNode.addEventListener("keypress",playTrack.bind(this)),this.trackList.push(a)}this.totalTracks=this.trackList.length;var i=document.createElement("div");i.className="apControls";var r=document.createElement("div");r.className="apPane left";var n=document.createElement("div");n.className="apPane right";var o=document.createElement("div");o.className="apProgress",this.ctrlPrevious=document.createElement("button"),this.ctrlPrevious.className="apControl apPrevious",this.ctrlPrevious.innerHTML="&lt;&lt;",this.tabIndex=this.totalTracks+5,this.ctrlPrevious.addEventListener("click",function(t){this.previous()}.bind(this)),this.ctrlPrevious.addEventListener("mouseout",blur),this.ctrlPlayPause=document.createElement("button"),this.ctrlPlayPause.className="apControl apPlay",this.ctrlPlayPause.innerHTML="play",this.tabIndex=this.totalTracks+2,this.ctrlPlayPause.dataset.mode="play",this.ctrlPlayPause.addEventListener("click",function(t){"play"===t.target.dataset.mode?this.play():this.pause(),t.preventDefault()}.bind(this)),this.ctrlPlayPause.addEventListener("mouseout",blur),this.ctrlNext=document.createElement("button"),this.ctrlNext.className="apControl apNext",this.ctrlNext.innerHTML="&gt;&gt;",this.tabIndex=this.totalTracks+6,this.ctrlNext.addEventListener("click",function(t){this.next()}.bind(this)),this.ctrlNext.addEventListener("mouseout",blur),this.ctrlStop=document.createElement("button"),this.ctrlStop.className="apControl apStop",this.ctrlStop.innerHTML="stop",this.tabIndex=this.totalTracks+3,this.ctrlStop.addEventListener("click",function(t){this.playing=!1,this.stop(),t.preventDefault()}.bind(this)),this.ctrlStop.addEventListener("mouseout",blur),this.seekBar=document.createElement("div"),this.seekBar.className="apSeekBar",this.seekBar.tabIndex=this.totalTracks+1,this.seekBar.title="Press the right or left arrow keys to seek forward or backward in the track.",this.seekBar.addEventListener("mouseover",function(t){this.playing&&(this.startSeek(),this.indicatorBar.style="opacity: .2;")}.bind(this)),this.seekBar.addEventListener("mousemove",function(t){this.seeking&&(this.indicatorBar.style="opacity: .2; width: "+t.offsetX+"px;")}.bind(this)),this.seekBar.addEventListener("mouseout",function(t){this.playing&&(this.stopSeek(),this.indicatorBar.style="opacity: 0;")}.bind(this)),this.seekBar.addEventListener("mousedown",function(t){(this.playing||this.pausing)&&this.seek(t.offsetX,this.seekBar.offsetWidth)}.bind(this)),this.seekBar.addEventListener("keydown",function(t){console.log(t.code),this.playing&&("ArrowLeft"===t.code?this.trackList[this.trackIndex].setCurrentTime(this.trackList[this.trackIndex].getCurrentTime()-5):"ArrowRight"===t.code&&this.trackList[this.trackIndex].setCurrentTime(this.trackList[this.trackIndex].getCurrentTime()+5))}.bind(this)),this.indicatorBar=document.createElement("div"),this.indicatorBar.className="apIndicatorBar",this.progressBar=document.createElement("div"),this.progressBar.className="apProgressBar",this.ctrlVolume=document.createElement("button"),this.ctrlVolume.className="apControl apVolume",this.ctrlVolume.innerHTML="Vol",this.tabIndex=this.totalTracks+4,this.ctrlVolume.dataset.opened=!1,this.ctrlVolume.addEventListener("click",function(t){"false"==t.target.dataset.opened?(this.panelVolume.className="apVolumePanel opened",t.target.dataset.opened=!0):(t.target.dataset.opened=!1,this.panelVolume.className="apVolumePanel closed")}.bind(this)),this.ctrlVolume.addEventListener("mouseout",blur),this.panelVolume=document.createElement("div"),this.panelVolume.className="apVolumePanel",this.volumeTotalBar=document.createElement("div"),this.volumeTotalBar.className="apIndicatorBar",this.volumeTotalBar.style="width: "+Math.round(100*this.globalVolume)+"%",this.panelVolume.addEventListener("mousedown",function(t){this.volumeDrag=!0,this.adjustVolume(t.offsetX,this.panelVolume.offsetWidth),this.volumeTotalBar.style="width:"+t.offsetX+"px;",t.preventDefault()}.bind(this)),this.panelVolume.addEventListener("mousemove",function(t){this.volumeDrag&&(this.adjustVolume(t.offsetX,this.panelVolume.offsetWidth),this.volumeTotalBar.style="width:"+t.offsetX+"px;"),t.preventDefault()}.bind(this)),this.panelVolume.addEventListener("mouseup",function(t){this.volumeDrag&&(this.volumeDrag=!1),t.preventDefault()}.bind(this)),this.panelVolume.addEventListener("mouseleave",function(t){this.volumeDrag&&(this.volumeDrag=!1),t.preventDefault()}.bind(this)),this.panelVolume.addEventListener("transitionend",function(t){"false"==this.ctrlVolume.dataset.opened&&(this.panelVolume.className="apVolumePanel closed hidden")}.bind(this)),this.panelVolume.appendChild(this.volumeTotalBar),this.seekBar.appendChild(this.progressBar),this.seekBar.appendChild(this.indicatorBar),o.appendChild(this.seekBar),r.appendChild(this.ctrlPlayPause),r.appendChild(this.ctrlStop),n.appendChild(this.ctrlVolume),n.appendChild(this.panelVolume),n.appendChild(this.ctrlPrevious),n.appendChild(this.ctrlNext),i.appendChild(r),i.appendChild(n),this.audioPlayerElement.appendChild(o),this.audioPlayerElement.appendChild(i)}function playTrack(t){var e;e="apProgressBar"==t.srcElement.className?t.srcElement.parentNode:t.srcElement,"mousedown"!==t.type&&("keypress"!==t.type||"Space"!==t.code&&"Enter"!==t.code)||(this.stop(),this.trackIndex=parseInt(e.dataset.number),this.play())}function blur(t){t.target.blur()}function Track(t){this.el=t,this.formattedTotalDuration="",this.available=!1,this.lblDuration=document.createElement("span"),this.lblDuration.className="apDuration",this.loadProgress=document.createElement("div"),this.loadProgress.className="apProgressBar",this.el.parentNode.appendChild(this.loadProgress),this.el.addEventListener("progress",function(t){var e=this.el.buffered,s=0;1==e.length&&(s=e.end(0)/this.el.duration),this.loadProgress.style="width: "+100*s+"%;"}.bind(this)),this.el.addEventListener("loadeddata",function(t){if(1===this.el.readyState||2===this.el.readyState||3===this.el.readyState||4===this.el.readyState){var e=this.getTotalTime(),s=Math.floor(e/3600),a=Math.floor((e-60*s)/60),i=Math.floor(e-60*s-60*a);s<10&&(s="0"+s),a<10&&(a="0"+a),i<10&&(i="0"+i),this.formattedTotalDuration="00"===s?a+":"+i:s+":"+a+":"+i,this.lblDuration.innerHTML=this.formattedTotalDuration,this.el.parentNode.appendChild(this.lblDuration)}}.bind(this)),this.el.addEventListener("canplay",function(t){4===this.el.readyState&&(this.available=!0,window.clearInterval(t.checkLoadState)),this.loadProgress.style="width: 100%;"}.bind(this)),this.el.addEventListener("waiting",function(t){console.log("buffering...")}.bind(this)),this.el.addEventListener("playing",function(t){console.log("resuming")}.bind(this))}AudioPlayer.prototype.play=function(){this.trackList[this.trackIndex].setVolume(this.globalVolume),this.trackList[this.trackIndex].play()?(this.playing=!0,this.pausing=!1,this.ctrlPlayPause.className="apControl apPause",this.ctrlPlayPause.innerHTML="pause",this.ctrlPlayPause.dataset.mode="pause",this.progressTimer=window.setInterval(this.checkProgress,10,this)):console.log("track not ready for playing")},AudioPlayer.prototype.pause=function(){this.pausing=!0,this.trackList[this.trackIndex].pause(),this.ctrlPlayPause.className="apControl apPlay",this.ctrlPlayPause.innerHTML="play",this.ctrlPlayPause.dataset.mode="play"},AudioPlayer.prototype.stop=function(){this.pausing=!1,this.trackList[this.trackIndex].stop(),null!==this.progressTimer&&(window.clearInterval(this.progressTimer),this.progressTimer=null),this.ctrlPlayPause.className="apControl apPlay",this.ctrlPlayPause.innerHTML="play",this.ctrlPlayPause.dataset.mode="play",this.clearProgress()},AudioPlayer.prototype.next=function(){this.stop(),this.trackIndex===this.trackList.length-1?this.trackIndex=0:this.trackIndex++,this.playing&&this.play()},AudioPlayer.prototype.previous=function(){this.stop(),0===this.trackIndex?this.trackIndex=this.trackList.length-1:this.trackIndex--,this.playing&&this.play()},AudioPlayer.prototype.checkProgress=function(t){var e=t.trackList[t.trackIndex].getCurrentTime(),s=t.trackList[t.trackIndex].getTotalTime(),a=Math.floor(e/3600),i=Math.floor((e-60*a)/60),r=Math.floor(e-60*a-60*i);a<10&&(a="0"+a),i<10&&(i="0"+i),r<10&&(r="0"+r),t.trackList[t.trackIndex].lblDuration.innerHTML="00"===a?i+":"+r:a+":"+i+":"+r,t.progressBar.style="width: "+e/s*100+"%",t.trackList[t.trackIndex].isEnded()&&t.next()},AudioPlayer.prototype.clearProgress=function(){this.trackList[this.trackIndex].resetDuration(),this.progressBar.style="width: 0%"},AudioPlayer.prototype.startSeek=function(){this.seeking=!0},AudioPlayer.prototype.stopSeek=function(){this.seeking=!1,this.indicatorBar.style="width: 0;"},AudioPlayer.prototype.seek=function(t,e){var s=this.trackList[this.trackIndex].getTotalTime(),a=t/e;this.trackList[this.trackIndex].setCurrentTime(a*s),this.pausing&&this.checkProgress(this)},AudioPlayer.prototype.mute=function(){this.muted?(this.muted=!1,this.ctrlVolume.className="apControl apVolume",this.trackList[this.trackIndex].setVolume(this.globalVolume)):(this.muted=!0,this.ctrlVolume.className="apControl apVolume apMuted",this.trackList[this.trackIndex].setVolume(0))},AudioPlayer.prototype.adjustVolume=function(t,e){t<0&&(t=0),this.globalVolume=t/e,this.trackList[this.trackIndex].setVolume(this.globalVolume)},Track.prototype.play=function(){return!!this.available&&(this.el.play(),this.el.parentNode.className+=" apActive",!0)},Track.prototype.pause=function(){this.el.pause()},Track.prototype.stop=function(){this.el.pause(),this.el.currentTime=0,this.el.parentNode.className="apTrack"},Track.prototype.getTotalTime=function(){return this.el.duration},Track.prototype.getCurrentTime=function(){return this.el.currentTime},Track.prototype.setCurrentTime=function(t){this.el.currentTime=t},Track.prototype.isEnded=function(){return this.el.ended},Track.prototype.getVolume=function(){return this.el.volume},Track.prototype.setVolume=function(t){this.el.volume=t},Track.prototype.resetDuration=function(){this.lblDuration.innerHTML=this.formattedTotalDuration},Track.prototype.canPlay=function(){return this.available};
